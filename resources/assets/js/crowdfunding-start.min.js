$(function(){function p(){var n=o.length;console.dir(o),$(".checkout").find("[data-step="+(n+1)+"]").animate({marginLeft:"0px"},"slow"),$(".checkout").find("[data-step="+n+"]").animate({marginLeft:"-590px"},"slow")}function f(){var n=o.length;$(".checkout").find("[data-step="+n+"]").animate({marginLeft:"0px"},"slow"),$(".checkout").find("[data-step="+(n+1)+"]").animate({marginLeft:"999999px"},"slow")}function u(n){for(var i in o)if(o[i].step==n)return!0;return!1}function r(n,i){for(var t in o)o[t].step==i&&(o[t].data=n)}function v(n,i){for(var t in o)if(o[t].step==n)for(var e in o[t].data)if(e==i)return o[t].data[e]}var l,t=($("input[name=project_name]").val(),$("input[name=org_name]").val(),$("#crowdFundingCheckout")),e=$("#crowdFundingCheckout").find(".checkout"),a=e.find(".incentives").find(".incentive"),d=e.find(".just-contribute"),s=e.find(".details"),o=[],c=4;$(".fund-project").on("click",function(){l=$(this).data("id");for(var n=0;c>n;n++)0==n?e.find("[data-step="+(n+1)+"]").css("marginLeft","0px"):e.find("[data-step="+(n+1)+"]").css("marginLeft","999999px");t.css("display","table")}),$(".incentive").on("click",function(){var n=$(this).data("incentive-id-front");l=$(".fund-project").data("id");for(var i=0;c>i;i++)0==i?e.find("[data-step="+(i+1)+"]").css("marginLeft","0px"):e.find("[data-step="+(i+1)+"]").css("marginLeft","999999px");e.find("[data-step=1]").find("[data-incentive-id="+n+"]").addClass("selected").find(".donation").slideDown(),t.css("display","table")}),a.on("click",function(){$(this).hasClass("selected")||(e.find(".incentive").each(function(){$(this).hasClass("selected")&&($(this).find(".donation").slideUp(),$(this).removeClass("selected"))}),e.find(".just-contribute").hasClass("selected")&&($(".just-contribute").find(".donation").slideUp(),$(".just-contribute").removeClass("selected")),$(this).addClass("selected"),$(this).find(".donation").slideDown())}),d.on("click",function(){$(this).hasClass("selected")||(e.find(".incentive").each(function(){$(this).hasClass("selected")&&($(this).find(".donation").slideUp(),$(this).removeClass("selected"))}),$(this).addClass("selected"),$(this).find(".donation").slideDown())}),a.find(".continue").on("click",function(){var n=e.find(".selected").data("incentive-id"),i=e.find(".incentive[data-incentive-id="+n+"]").find("input[name=donationAmt]").val(),t=new Array;if(isNaN(parseInt(i)),0==t.length){u(1)?r({type:"incentive",id:n,amount:i},1):o.push({step:1,data:{type:"incentive",id:n,amount:i}});var a=e.find(".incentives").find(".incentive[data-incentive-id="+n+"]"),d=a.find(".title").text(),s=a.find(".description").text(),l=e.find(".details").find(".details-incentive");l.find(".title").text(d),l.find(".description").text(s),l.find(".donation-amount").find("span").text(i),e.find(".details .details-incentive .donation-amount button").removeClass("edit-amount").addClass("edit-incentive").html("edit incentive"),p()}}),d.find(".continue").on("click",function(){var n=d.find("input[name=donationAmt]").val(),i=new Array;isNaN(parseInt(n)),0==i.length&&(u(1)?r({type:"fund",amount:n},1):o.push({step:1,data:{type:"fund",amount:n}}),e.find(".details").find(".donation-amount span").html(n),e.find(".details .details-incentive .donation-amount button").removeClass("edit-incentive").addClass("edit-amount").html("change amount "),p())}),s.find("button.donation-button").on("click",function(){f()}),$(".donation-amount button").on("click",function(n){n.preventDefault(),n.stopPropagation(),f()}),$("select[name=userAddresses]").on("change",function(){var n=$(this).find(":selected").val();if(0==n)$("input[name=shippingAddress1]").val(""),$("input[name=shippingAddress2]").val(""),$("input[name=shippingCity]").val(""),$("input[name=shippingState]").val(""),$("input[name=shippingZip]").val(""),$("input[name=shippingCountry]").val("");else{var i=n.split("|");"shipping"==i[1]&&($("input[name=shippingAddress1]").val(i[2]),$("input[name=shippingAddress2]").val(i[3]),$("input[name=shippingCity]").val(i[4]),$("input[name=shippingState]").val(i[5]),$("input[name=shippingZip]").val(i[6]),$("input[name=shippingCountry]").val(i[7]))}}),$(".continueCheckout").on("click",function(){var n=$("form[name=fundingCheckoutForm]").serialize();$.ajax({url:"/crowdfunding/validateFunding",method:"POST",data:n,beforeSend:function(){$(".error").html("").addClass("hidden")},success:function(){var n=$("form[name=fundingCheckoutForm]");u(2)?r({full_name:n.find("input[name=name]").val(),email:n.find("input[name=email]").val(),shippingAddr1:n.find("input[name=shippingAddress1]").val(),shippingAddr2:n.find("input[name=shippingAddress2]").val(),shippingCity:n.find("input[name=shippingCity]").val(),shippingState:n.find("input[name=shippingState]").val(),shippingZip:n.find("input[name=shippingZip]").val(),shippingCountry:n.find("input[name=shippingCountry]").val(),cc_num:n.find("input[name=cc_number]").val(),name_on_card:n.find("input[name=name_on_card]").val(),exp_date:n.find("input[name=exp_date]").val(),ccv:n.find("input[name=ccv]").val(),billingAddr1:n.find("input[name=billingAddress1]").val(),billingAddr2:n.find("input[name=billingAddress2]").val(),billingCity:n.find("input[name=billingCity]").val(),billingState:n.find("input[name=billingState]").val(),billingZip:n.find("input[name=billingZip]").val(),billingCountry:n.find("input[name=billingCountry]").val()},1):o.push({step:2,data:{full_name:n.find("input[name=name]").val(),email:n.find("input[name=email]").val(),shippingAddr1:n.find("input[name=shippingAddress1]").val(),shippingAddr2:n.find("input[name=shippingAddress2]").val(),shippingCity:n.find("input[name=shippingCity]").val(),shippingState:n.find("input[name=shippingState]").val(),shippingZip:n.find("input[name=shippingZip]").val(),shippingCountry:n.find("input[name=shippingCountry]").val(),cc_num:n.find("input[name=cc_number]").val(),name_on_card:n.find("input[name=name_on_card]").val(),exp_date:n.find("input[name=exp_date]").val(),ccv:n.find("input[name=ccv]").val(),billingAddr1:n.find("input[name=billingAddress1]").val(),billingAddr2:n.find("input[name=billingAddress2]").val(),billingCity:n.find("input[name=billingCity]").val(),billingState:n.find("input[name=billingState]").val(),billingZip:n.find("input[name=billingZip]").val(),billingCountry:n.find("input[name=billingCountry]").val()}});var i=v(1,"id"),t=e.find(".incentives").find(".incentive[data-incentive-id="+i+"]"),a=e.find(".details"),d=e.find(".review");"incentive"==v(1,"type")?(console.log("title: "+t.find(".title").text()),d.find(".incentive-title").html(t.find(".title").text()),d.find(".incentive-description").html(t.find(".description").text())):console.log("donate"),d.find(".donation-amount").html(v(1,"amount")),d.find(".shippingaddress1").text(a.find("input[name='shippingAddress1']").val()),d.find(".shippingaddress2").text(a.find("input[name='shippingAddress2']").val()),d.find(".shippingcity").text(a.find("input[name='shippingCity']").val()),d.find(".shippingstate").text(a.find("input[name='shippingState']").val()),d.find(".shippingzip").text(a.find("input[name='shippingZip']").val()),d.find(".shippingcountry").text(a.find("input[name='shippingCountry']").val()),d.find(".cc-num").text(a.find("input[name='cc_number']").val()),d.find(".cc-name").text(a.find("input[name='name_on_card']").val()),d.find(".cc-expdate").text(a.find("input[name='exp_date']").val()),d.find(".cc-ccv").text(a.find("input[name='ccv']").val()),d.find(".billingaddress1").text(a.find("input[name='billingAddress1']").val()),d.find(".billingaddress2").text(a.find("input[name='billingAddress2']").val()),d.find(".billingcity").text(a.find("input[name='billingCity']").val()),d.find(".billingstate").text(a.find("input[name='billingState']").val()),d.find(".billingzip").text(a.find("input[name='billingZip']").val()),d.find(".billingcountry").text(a.find("input[name='billingCountry']").val()),p()},statusCode:{422:function(n){var e=JSON.parse(n.responseText);for(var a in e)$("."+a+"-error").html(e[a]).removeClass("hidden")}}})}),$(".exit-crowdfunding-checkout").on({mouseover:function(){$(this).css("cursor","pointer")},mouseleave:function(){$(this).css("cursor","auto")},click:function(){o=[],a.removeClass("selected"),a.find(".donation").slideUp(),d.find("input").val(""),d.find(".donation").slideUp(),d.removeClass("selected"),$("form[name=fundingCheckoutForm]")[0].reset(),$("#crowdFundingCheckout").hide()}})});