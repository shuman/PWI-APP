$(function(){function h(){var n=r.length;console.dir(r),$(".checkout").find("[data-step="+(n+1)+"]").animate({marginLeft:"0px"},"slow"),$(".checkout").find("[data-step="+n+"]").animate({marginLeft:"-590px"},"slow")}function g(){var n=r.length;$(".checkout").find("[data-step="+n+"]").animate({marginLeft:"0px"},"slow"),$(".checkout").find("[data-step="+(n+1)+"]").animate({marginLeft:"999999px"},"slow")}function b(n){for(var i in r)if(r[i].step==n)return!0;return!1}function C(n,i){for(var t in r)r[t].step==i&&(r[t].data=n)}function x(n,i){for(var t in r)if(r[t].step==n)for(var e in r[t].data)if(e==i)return r[t].data[e]}$chartColorArray=["#339933","#33bbcc","#ffff00","#ff3300","#6600cc","#ff6600","#ff0000","#006600","#33ccff","#ffccff","#6666ff","#ff0066","#666699","#ffff66","#336699","#999933","#cc0066","#9933ff","#000000","#99ccff"],$(".countryCauseName").on("click",function(){var n=$(this).data("cause");$(".countryCauseName").removeClass("active"),$(this).addClass("active"),$(".country-cause-description").addClass("hidden"),$("."+n+"-description").removeClass("hidden")});var i,a=(new google.maps.LatLngBounds,$("input[name=latitude]").val()),d=$("input[name=longitude]").val(),s=document.getElementById("map"),o={zoom:3,center:new google.maps.LatLng(a,d),myTypeid:google.maps.MapTypeId.ROADMAP,styles:styles,animatedZoom:!0,disableDefaultUI:!0};i=new google.maps.Map(s,o),$(".charts").each(function(n){for(var i=[],t=$(this).find("input[name='item_name[]']"),e=$(this).find("input[name='item_percentage[]']"),n=0;n<t.length;n++)i.push({label:$(t[n]).val(),value:parseFloat($(e[n]).val()),color:$chartColorArray[n],highlight:$chartColorArray[n]});console.dir(i);var a=$(this).find("canvas"),d=new Chart(a[0].getContext("2d")).Pie(i,{legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'}),s=d.generateLegend();$(this).find(".chart-legend").html(s)});var m,l=$("#countryCheckout"),c=l.find(".checkout"),p=c.find(".donation"),u=c.find(".details"),f=c.find(".review"),r=[],v=4;$(".donate-button").on({mouseover:function(){$(this).css("cursor","pointer")},mouseleave:function(){$(this).css("cursor","auto")},click:function(){m=$(this).data("id");for(var n=0;v>n;n++)0==n?c.find("[data-step="+(n+1)+"]").css("marginLeft","0px"):c.find("[data-step="+(n+1)+"]").css("marginLeft","999999px");l.css("display","table")}}),$(".exit-country-checkout").on({mouseover:function(){$(this).css("cursor","pointer")},mouseleave:function(){$(this).css("cursor","auto")},click:function(){r=[],p.find("input").val(""),$("form[name=donationCheckoutForm]")[0].reset(),l.hide()}}),p.find(".continue").on("click",function(){var n=p.find("input[name=donationAmt]").val(),i=new Array;0==i.length&&(b(1)?C({amount:n},1):r.push({step:1,data:{amount:n}}),c.find(".details").find(".donation-amount span").html(n),h())}),u.find("button.donation-button").on("click",function(){g()}),$("select[name=userAddresses]").on("change",function(){var n=$(this).find(":selected").val();if(0==n)$("input[name=billingAddress1]").val(""),$("input[name=billingAddress2]").val(""),$("input[name=billingCity]").val(""),$("input[name=billingState]").val(""),$("input[name=billingZip]").val(""),$("input[name=billingCountry]").val("");else{var i=n.split("|");$("input[name=billingAddress1]").val(i[2]),$("input[name=billingAddress2]").val(i[3]),$("input[name=billingCity]").val(i[4]),$("input[name=billingState]").val(i[5]),$("input[name=billingZip]").val(i[6]),$("input[name=billingCountry]").val(i[7])}}),$(".continueCheckout").on("click",function(){var n=$("form[name=donationCheckoutForm]").serialize();$.ajax({url:"/country/validateDonation",method:"POST",data:n,beforeSend:function(){$(".error").html("").addClass("hidden")},success:function(){var n=$("form[name=donationCheckoutForm]");b(2)?C({full_name:n.find("input[name=name]").val(),email:n.find("input[name=email]").val(),cc_num:n.find("input[name=cc_number]").val(),name_on_card:n.find("input[name=name_on_card]").val(),exp_date:n.find("input[name=exp_date]").val(),ccv:n.find("input[name=ccv]").val(),billingAddr1:n.find("input[name=billingAddress1]").val(),billingAddr2:n.find("input[name=billingAddress2]").val(),billingCity:n.find("input[name=billingCity]").val(),billingState:n.find("input[name=billingState]").val(),billingZip:n.find("input[name=billingZip]").val(),billingCountry:n.find("input[name=billingCountry]").val()},2):r.push({step:2,data:{full_name:n.find("input[name=name]").val(),email:n.find("input[name=email]").val(),cc_num:n.find("input[name=cc_number]").val(),name_on_card:n.find("input[name=name_on_card]").val(),exp_date:n.find("input[name=exp_date]").val(),ccv:n.find("input[name=ccv]").val(),billingAddr1:n.find("input[name=billingAddress1]").val(),billingAddr2:n.find("input[name=billingAddress2]").val(),billingCity:n.find("input[name=billingCity]").val(),billingState:n.find("input[name=billingState]").val(),billingZip:n.find("input[name=billingZip]").val(),billingCountry:n.find("input[name=billingCountry]").val()}}),f.find(".donation-amount").html(x(1,"amount")),f.find(".cc-num").text(u.find("input[name='cc_number']").val()),f.find(".cc-name").text(u.find("input[name='name_on_card']").val()),f.find(".cc-expdate").text(u.find("input[name='exp_date']").val()),f.find(".cc-ccv").text(u.find("input[name='ccv']").val()),f.find(".billingaddress1").text(u.find("input[name='billingAddress1']").val()),f.find(".billingaddress2").text(u.find("input[name='billingAddress2']").val()),f.find(".billingcity").text(u.find("input[name='billingCity']").val()),f.find(".billingstate").text(u.find("input[name='billingState']").val()),f.find(".billingzip").text(u.find("input[name='billingZip']").val()),f.find(".billingcountry").text(u.find("input[name='billingCountry']").val()),h()},statusCode:{422:function(n){var e=JSON.parse(n.responseText);for(var a in e)$("."+a+"-error").html(e[a]).removeClass("hidden")}}})}),f.find(".edit-button").on("click",function(){g()})});