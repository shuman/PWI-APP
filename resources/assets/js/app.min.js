window.$=window.jQuery=require("jquery"),require("bootstrap-sass"),String.prototype.stripSlashes=function(){return this.replace(/\\(.)/gm,"$1")},$(function(){function x(){var d="";switch(a){case"org":d="/organization/more";break;case"crowdfunding":d="/crowdfunding/more";break;case"products":d="/products/more"}$.ajax({method:"POST",url:d,data:{payload:t,next:e},dataType:"json",beforeSend:function(){$(".loadingMore").show()},success:function(d){switch(d.count<t&&(i=!0),a){case"org":y(d);break;case"crowdfunding":w(d);case"products":A(d)}n=!1,$(".loadingMore").hide(),e+=t}})}function k(n){var i=/causes$/,t=/countries$/,e=/projects$/,a=/products$/,d=/organizations$/;return i.test(n)?"causes":t.test(n)?"country":e.test(n)?"projects":a.test(n)?"products":d.test(n)?"organziations":void 0}function y(n){var t=(new Array,n.path);delete n.path;var e="";for(var a in n){e+="<div class='org-module margin-top-10'>",e+="   <div class='org-module-top'>",e+="       <div class='org-module-img-container margin-right-10 margin-bottom-5 padding-0 pull-left'>",e+="           <img src='"+t+n[a].logoImg+"' align='left'/>",e+="           <br />",e+="           <div class='rating below-image'>";for(var d=1;6>d;d++)d<=n[a].rating?(e+="       <span class='star fill' >",e+="           <i data-icon='&#xe017;' class='icon pwi-icon-2em'></i>",e+="       </span>"):(e+="       <span class='star' >",e+="           <i data-icon='&#xe017;' class='icon pwi-icon-2em'></i>",e+="       </span>");e+="           </div>",e+="       </div>",e+="       <div class='pull-left'>",e+="           <div class='org-module-name pull-left'>"+n[a].org_name.stripSlashes()+"</div>",e+="               <div class='impacts-causes'>",e+="                   <span class='title'>Locations</span><span class='caret'></span><br />",e+="                   <span class='list'>";for(var d=0;d<n[a].countries.length;d++)e+=0==d?n[a].countries[d].country_name:", "+n[a].countries[d].country_name;e+="                   </span>",e+="               </div>",e+="               <div class='impacts-causes'>",e+="                   <span class='title'>Causes</span><span class='caret'></span><br />",e+="                   <span class='list'>";for(var d=0;d<n[a].causes.length;d++)e+=0==d?n[a].causes[d].cause_name:", "+n[a].causes[d].cause_name;e+="                   </span>",e+="               </div>",e+="           </div>",e+="       </div>",e+="   </div>",e+="</div>"}$(".orgs-module").append(e)}function w(n){var t=(new Array,n.path);delete n.path,delete n.count;var e="";for(var a in n){console.log(n[a]),e+="<div class='project-module'>",e+="   <div class='project-module-top'>",e+="       <div class='project-module-img-container margin-right-10 margin-bottom-5 padding-0 pull-left'>",e+="           <img src='"+t+n[a].icon+"' align='left'/>",e+="        </div>",e+="        <div class='pull-left'>",e+="           <div class='project-module-name pull-left'>"+n[a].title+"</div>",e+="           <div class='project-module-org-name'>",e+=n[a].org_name.stripSlashes(),e+="           </div>",e+="           <div class='impacts-causes'>",e+="               <span class='title'>Locations</span><span class='caret'></span><br />",e+="                <span class='list'>";for(var d=0;d<n[a].countries.length;d++)e+=0==d?n[a].countries[d].country_name:", "+n[a].countries[d].country_name;e+="                </span>",e+="           </div>",e+="           <div class='impacts-causes'>",e+="               <span class='title'>Causes</span><span class='caret'></span><br />",e+="               <span class='list'>";for(var s=0;s<n[a].causes.length;s++)e+=0==s?n[a].causes[s].cause_name:", "+n[a].causes[s].cause_name;e+="               </span>",e+="           </div>",e+="        </div>",e+="   </div>",e+="   <div style='clear:both;'></div>",e+="   <div class='project-module-status'>",e+="       <div class='status-line'>",e+="           <div class='pull-left projectRaisedAmt'>",e+=n[a].amtRaised,e+="           </div>",e+="           <div class='pull-right projectGoal'>",e+="               out of <span class='projectGoalAmt'>"+n[a].fundGoal+"</span>",e+="           </div>",e+="       </div>",e+="       <div class='status-line'>",e+="           <div class='progress'>",e+="               <div class='progress-bar' role='progressbar' aria-valuenow='75' aria-valuemin='0' aria-valuemax='100' style='width: "+n[a].percentage+"%;'></div>",e+="           </div>",e+="       </div>",e+="       <div class='status-line'>",e+="           <div class='pull-left projectGoal'>",e+=n[a].percentage+"% complete",e+="           </div>",e+="           <div class='pull-right projectGoal'>",e+="               <span class='projectGoalAmt'>"+n[a].daysleft+"</span> days left",e+="           </div>",e+="       </div>",e+="   </div>",e+="</div>"}$(".projects").append(e)}function A(n){new Array,n.path;delete n.path;for(var a in n);}var n=!1,i=!1;if($(".modal").height($(document).height()),$(window).on("resize",function(){$(".modal").height($(document).height())}),$("input[name=initialLoad]").length>0){var t=$("input[name=initialLoad]").val(),e=$("input[name=nextPayload]").val(),a=$("input[name=page]").val();$(window).on("scroll",function(){var t=$("footer").position().top,e=$(window).scrollTop(),a=$(window).height();e+a>=t&&(n||i||(n=!0,x()))})}$(".openCauseModal").on("click",function(n){n.stopPropagation(),n.preventDefault(),$("#causeModal").css("display","table")}),$(".openCountryModal").on("click",function(n){n.stopPropagation(),n.preventDefault(),$("#countryModal").css("display","table")}),$(".home-nav-search .search").on("click",function(){var n=$("input[name=search]").val();""==n||(location.href="/search/"+n)}),$(".signin").popover({content:"<div class='login-popover-wrapper'>"+$(".login-wrapper").html()+"</div>",html:!0,placement:"bottom",container:".navbar-right",trigger:"click",template:'<div class="popover login-popover" role="tooltip"><div class="arrow" class="left: 80%;"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),$(".signin").on("click",function(n){n.preventDefault(),n.stopPropagation()}),$(".signin").on("shown.bs.popover",function(){var n=parseInt($(".login-popover").css("top")),i=parseInt($(".login-popover").css("left"));$(".login-popover").css({top:n+10+"px",left:i-5+"px"})}),$(document).on("click",".login-popover-wrapper #actionSignIn",function(){var n=$("input[name=email]").val(),i=$("input[name=password]").val();$.ajax({method:"post",url:"/auth/login",beforeSend:function(){$(".login-popover-wrapper").find(".error").addClass("hidden")},data:{email:n,password:i,_token:$("input[name=_token]").val()},dataType:"json",success:function(n){if(n.status)location.href=n.intended;else for(h in n.errors)"email"==h&&$(".email-error").html(n.errors[h]).removeClass("hidden"),("password"==h||"generic"==h)&&$(".generic-error").html(n.errors[h]).removeClass("hidden")}})}),$(".toUserPortal").on("click",function(n){n.preventDefault(),n.stopPropagation(),$("form[name=passthru]").trigger("submit")}),$(".cause-container a").on({mouseover:function(){var n=$(this).data("cause");$(this).parent().find(".center").html(n)},mouseleave:function(){$(this).parent().find(".center").html("")}});var d="";$(".country-overlay-item").on({mouseover:function(){d=$(this).data("iso-code").toLowerCase();var n=$(this).text();$(".country-overlay-name").html(n),$(".country-space").find(".flag-icon").addClass("flag-icon-"+d),$(".country-space").css("visibility","visible")},mouseleave:function(){$(".country-space").css("visibility","hidden"),$(".country-overlay-name").html(""),$(".country-space").find(".flag-icon").removeClass("flag-icon-"+d)}}),$(".readmore").on("click",function(n){n.preventDefault(),n.stopPropagation(),$(this).parent().find(".more").show(),$(this).hide(),$(this).parent().find(".readless").show()}),$(".readless").on("click",function(n){n.preventDefault(),n.stopPropagation(),$(this).parent().find(".more").hide(),$(this).hide(),$(this).parent().find(".readmore").show()}),$(".whatis").on("click",function(n){n.preventDefault(),n.stopPropagation(),$("#wrapper").animate({marginTop:"662px"},"slow"),$(".pull-down-about").animate({top:"0px"},"slow")}),$(".exit-pull-down").on("click",function(){$(".pull-down-about").animate({top:"-662px"},"slow"),$("#wrapper").animate({marginTop:"0px"},"slow")});var s=null,a=$("input[name=page]").val();if($("input[name=search]").on("keyup",function(){var i=$(this),t=$(this).val();t.length>2?(s&&4!=s.readyState&&s.abort(),s=$.ajax({url:"/search/"+t,dataType:"json",success:function(n){if(n.length>0){var e="<ul style='position:relative;'>",a=/^cause/,d=/^country/;for(var s in n)if(a.test(n[s].recordtype)){var o=k(n[s].recordtype);e+="<li tabindex='"+s+"'><a href='/cause/"+n[s].alias+"/"+o+"/"+t+"'>"+n[s].name.stripSlashes()+"</a></li>"}else d.test(n[s].recordtype)?e+="<li tabindex='"+s+"' ><a href='/cause/"+n[s].alias+"/"+o+"/"+t+"'>"+n[s].name.stripSlashes()+"</a></li>":"organization"==n[s].recordtype?e+="<li tabindex='"+s+"'><a href='/organization/"+n[s].alias+"'>"+n[s].name.stripSlashes()+"</a></li>":console.log("effed");e+="</ul>";var l="Suggestions based on your search for '<b >"+t+"</b>'. <span class='glyphicon glyphicon-remove clear-popover' aria-hidden='true'></span>";$(".popover").hasClass("in")?($(".popover-content").html(e),$(".popover-title b").html(t)):i.popover({content:e,title:l,placement:"bottom",container:"body",html:!0,trigger:"manual",template:'<div class="popover selective-search" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}).popover("show"),$(".clear-popover").on("click",function(){$("input[name=search]").popover("destroy")})}}})):$(".autocompleteResults").html("")}),$(".area-list").length>0){var l=new google.maps.LatLngBounds,p=(new google.maps.InfoWindow,new Array),u=(new Array,new Array);$(".area-list > div").each(function(){var n=new Object;n.name=$(this).find(".country-name").text(),n.lat=parseFloat($(this).find("input[name=lat]").val()),n.lng=parseFloat($(this).find("input[name=lng]").val()),n.alias=$(this).find("input[name=alias]").val(),u.push(n)});var f=document.getElementById("map"),v={zoom:5,center:new google.maps.LatLng(u[0].lat,u[0].lng),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:styles,animatedZoom:!0,disableDefaultUI:!0},m=new google.maps.Map(f,v);m.addListener("mouseover",function(){m.setOptions({disableDefaultUI:!1})}),m.addListener("mouseout",function(){m.setOptions({disableDefaultUI:!0})});for(var h in u){var g=new google.maps.InfoWindow({content:"<b>"+u[h].name+"</b><br /><a href='/country/"+u[h].alias+"'>View Country</a>"});p.push(new google.maps.Marker({position:{lat:u[h].lat,lng:u[h].lng},map:m,animation:google.maps.Animation.DROP,title:u[h].name,infowindow:g}))}for(var b in p){google.maps.event.addListener(p[b],"click",function(){"undefined"!=typeof lastInfoWindowOpened&&lastInfoWindowOpened.close(),lastInfoWindowOpened=this.infowindow,this.infowindow.open(m,this)}),l.extend(p[b].position),m.fitBounds(l)}}$("input[name=sameAsShipping]").on("click",function(){$(this).is(":checked")?($("input[name=billingAddress1]").val($("input[name=shippingAddress1]").val()),$("input[name=billingAddress2]").val($("input[name=shippingAddress2]").val()),$("input[name=billingCity]").val($("input[name=shippingCity]").val()),$("input[name=billingState]").val($("input[name=shippingState]").val()),$("input[name=billingZip]").val($("input[name=shippingZip]").val()),$("input[name=billingCountry]").val($("input[name=shippingCountry]").val())):($("input[name=billingAddress1]").val(""),$("input[name=billingAddress2]").val(""),$("input[name=billingCity]").val(""),$("input[name=billingState]").val(""),$("input[name=billingZip]").val(""),$("input[name=billingCountry]").val(""))})});