$(function(){function r(){var n=d.length;console.dir(d),$(".checkout").find("[data-step="+(n+1)+"]").animate({marginLeft:"0px"},"slow"),$(".checkout").find("[data-step="+n+"]").animate({marginLeft:"-590px"},"slow")}function m(){var n=d.length;$(".checkout").find("[data-step="+n+"]").animate({marginLeft:"0px"},"slow"),$(".checkout").find("[data-step="+(n+1)+"]").animate({marginLeft:"999999px"},"slow")}function c(n){for(var i in d)if(d[i].step==n)return!0;return!1}function f(n,i){for(var a in d)d[a].step==i&&(d[a].data=n)}function p(n,i){for(var a in d)if(d[a].step==n)for(var t in d[a].data)if(t==i)return d[a].data[t]}$(".subCauseName").on("click",function(){var n=$(this).data("cause");$(".subCauseName").removeClass("active"),$(this).addClass("active"),$(".subcause-description").addClass("hidden"),$(".subcause-description-"+n).removeClass("hidden")});var u,n=$("input[name=paypalUn]").val(),i=$("form[name=donationCheckoutForm]").find("input[name=user_id]").val(),a=$("#causeCheckout"),t=$("#causeCheckout").find(".checkout"),e=t.find(".donation"),l=t.find(".details"),o=t.find(".review"),d=[],s=4;$(".donate-button").on({mouseover:function(){$(this).css("cursor","pointer")},mouseleave:function(){$(this).css("cursor","auto")},click:function(){u=$(this).data("id");for(var n=0;s>n;n++)0==n?t.find("[data-step="+(n+1)+"]").css("marginLeft","0px"):t.find("[data-step="+(n+1)+"]").css("marginLeft","999999px");a.css("display","table")}}),$(".exit-cause-checkout").on({mouseover:function(){$(this).css("cursor","pointer")},mouseleave:function(){$(this).css("cursor","auto")},click:function(){d=[],e.find("input").val(""),$("form[name=donationCheckoutForm]")[0].reset(),a.hide()}}),e.find(".continue").on("click",function(){var n=e.find("input[name=donationAmt]").val(),i=new Array;0==i.length&&(c(1)?f({amount:n},1):d.push({step:1,data:{amount:n}}),t.find(".details").find(".donation-amount span").html(n),r())}),l.find("button.donation-button").on("click",function(){m()}),$("select[name=userAddresses]").on("change",function(){var n=$(this).find(":selected").val();if(0==n)$("input[name=billingAddress1]").val(""),$("input[name=billingAddress2]").val(""),$("input[name=billingCity]").val(""),$("input[name=billingState]").val(""),$("input[name=billingZip]").val(""),$("input[name=billingCountry]").val("");else{var i=n.split("|");$("input[name=billingAddress1]").val(i[2]),$("input[name=billingAddress2]").val(i[3]),$("input[name=billingCity]").val(i[4]),$("input[name=billingState]").val(i[5]),$("input[name=billingZip]").val(i[6]),$("input[name=billingCountry]").val(i[7])}}),$(".continueCheckout").on("click",function(){var n=$("form[name=donationCheckoutForm]").serialize(),i=$(this);$.ajax({url:"/cause/validateDonation",method:"POST",data:n,beforeSend:function(){$(".error").html("").addClass("hidden"),i.html("Validating..."),i.prop("disabled",!0)},success:function(){var n=$("form[name=donationCheckoutForm]");c(2)?f({first_name:n.find("input[name=first_name]").val(),last_name:n.find("input[name=last_name]").val(),email:n.find("input[name=email]").val(),cc_num:n.find("input[name=cc_number]").val(),name_on_card:n.find("input[name=name_on_card]").val(),exp_date:n.find("input[name=exp_date]").val(),ccv:n.find("input[name=ccv]").val(),billingAddr1:n.find("input[name=billingAddress1]").val(),billingAddr2:n.find("input[name=billingAddress2]").val(),billingCity:n.find("input[name=billingCity]").val(),billingState:n.find("input[name=billingState]").val(),billingZip:n.find("input[name=billingZip]").val(),billingCountry:n.find("input[name=billingCountry]").val()},2):d.push({step:2,data:{first_name:n.find("input[name=first_name]").val(),last_name:n.find("input[name=last_name]").val(),email:n.find("input[name=email]").val(),cc_num:n.find("input[name=cc_number]").val(),name_on_card:n.find("input[name=name_on_card]").val(),exp_date:n.find("input[name=exp_date]").val(),ccv:n.find("input[name=ccv]").val(),billingAddr1:n.find("input[name=billingAddress1]").val(),billingAddr2:n.find("input[name=billingAddress2]").val(),billingCity:n.find("input[name=billingCity]").val(),billingState:n.find("input[name=billingState]").val(),billingZip:n.find("input[name=billingZip]").val(),billingCountry:n.find("input[name=billingCountry]").val()}}),o.find(".donation-amount").html(p(1,"amount")),o.find(".cc-num").text(l.find("input[name='cc_number']").val()),o.find(".cc-name").text(l.find("input[name='name_on_card']").val()),o.find(".cc-expdate").text(l.find("input[name='exp_date']").val()),o.find(".cc-ccv").text(l.find("input[name='ccv']").val()),o.find(".billingaddress1").text(l.find("input[name='billingAddress1']").val()),o.find(".billingaddress2").text(l.find("input[name='billingAddress2']").val()),o.find(".billingcity").text(l.find("input[name='billingCity']").val()),o.find(".billingstate").text(l.find("input[name='billingState']").val()),o.find(".billingzip").text(l.find("input[name='billingZip']").val()),o.find(".billingcountry").text(l.find("input[name='billingCountry']").val()),i.val("review order"),i.prop("disabled",!1),r()},statusCode:{422:function(n){var t=JSON.parse(n.responseText);for(var e in t)$("."+e+"-error").html(t[e]).removeClass("hidden")}}})}),o.find(".checkout-button").on("click",function(){$donationId="",$.ajax({method:"get",url:"/setPendingDonation",data:{user_id:i,item_id:u,item_type:"cause",billing_full_name:p(2,"first_name")+" "+p(2,"last_name"),billing_address_line1:p(2,"billingAddr1"),billing_address_line2:p(2,"billingAddr2"),billing_city:p(2,"billingCity"),billing_state:p(2,"billingState"),billing_country:p(2,"billingCountry"),billing_zip:p(2,"billingZip"),donation_amount:p(1,"amount")},dataType:"json",success:function(i){dataId=i.id;var a=$("form[name=paypalStdCheckout]");$("input[name=cmd]").val("_donations"),$("input[name=return]").val("http://pwi.dev.com/thankyou"),$("input[name=notify_url]").val("http://pwi.dev.com/ipn"),$("input[name=amount]").val(p(1,"amount")),$("input[name=custom]").val(dataId),$("input[name=business]").val(n),$("input[name=first_name]").val(p(2,"first_name")),$("input[name=last_name]").val(p(2,"last_name")),$("input[name=address1]").val(p(2,"billingAddr1")),$("input[name=address2]").val(p(2,"billingAddr2")),$("input[name=city]").val(p(2,"billingCity")),$("input[name=state]").val(p(2,"billingState")),$("input[name=zip]").val(p(2,"billingZip")),$("input[name=country]").val(p(2,"billingCountry")),a.trigger("submit")}})}),o.find(".edit-button").on("click",function(){m()})});