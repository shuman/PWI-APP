{"version":3,"sources":["donate.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"donate.js","sourcesContent":["$(function( ){\n\t\n\tvar donationObj \t= {};\n\tvar userId \t\t\t= $(\"input[name=user_id]\").val( );\n\tvar paypal_username = $(\"input[name=paypal_un]\").val( );\n\tvar payment_gateway = $(\"input[name=payment_gateway]\").val( );\n\n\t$(\"input[name=user_id]\").remove( );\n\t$(\"input[name=paypal_un]\").remove( );\n\t$(\"input[name=payment_gateway]\").remove( );\n\n\tvar id \t\t= $(\"input[name=donate_id]\").val( );\n\tvar type \t= $(\"input[name=type]\").val( );\n\n\tif( $(\"input[name=donationAmt]\").length > 0 && $(\"input[name=donationAmt]\").val( ) != \"\" ){\n\t\tdonationObj.amount = parseFloat( $(\"input[name=donationAmt]\").val( ) ).formatMoney(2, ',', '.');\n\t}else{\n\t\tdonationObj.amount = 0.00\n\t}\n\n\t$(\".chg-amount\").on(\"click\", function( ){\n\n\t\tvar $parent = $(this).parent( ).parent( );\n\n\t\t$parent.find(\"span\").hide( );\n\n\t\t$parent.find(\"input[type=text]\").removeClass('hidden');\n\n\t\t$(this)\n\t\t.removeClass('chg-amount')\n\t\t.addClass('save-amount')\n\t\t.css('width', '45%')\n\t\t.html('Save');\n\n\t\t$(this).parent( ).find(\".cancel-amount\").removeClass('hidden');\n\t});\n\n\t$(document).on(\"click\", \".save-amount\", function( ){\n\n\t\tvar $this = $(this);\n\n\t\tvar donation = $(\"input[name=donation]\").val( );\n\n\t\tvar $parent = $(this).parent( ).parent( );\n\n\t\tif( isNaN( parseFloat( donation) ) ){\n\n\t\t}else{\n\t\t\tdonationObj.amount = parseFloat( donation ).formatMoney(2, ',','.');\n\n\t\t\t$parent.find(\"span\").html( \"$\" + donationObj.amount );\n\n\t\t\t$parent.find(\"input[type=text]\").val(\"\").addClass('hidden');\n\n\t\t\t$(this)\n\t\t\t.removeClass('save-amount')\n\t\t\t.addClass('chg-amount')\n\t\t\t.val('Change Amount');\n\t\t}\n\t});\n\n\t$(\".cancel-amount\").on(\"click\", function( ){\n\n\t\tvar $parent = $(this).parent( ).parent( );\n\n\t\t//reset donation text box, if it has been filled.\n\t\t$(\"input[name=donation]\").val(\"\").addClass('hidden');\n\n\t\t$parent.find(\".donate-button\")\n\t\t.removeClass('save-amount')\n\t\t.addClass('chg-amount')\n\t\t.css('width', '100%')\n\t\t.html('Change Amount');\n\n\t\t$parent.find(\"span\").show( );\n\n\t\t$(this).addClass('hidden');\n\t});\n\n\t$(\".continueCheckout\").on(\"click\", function( ){\n        \n        var formData = $('form[name=donationCheckoutForm]').serialize( );\n        var type = $(\"input[name=saveAddress]\").data('type');\n        \n        var $button = $(this);\n        \n        $.ajax({\n            url: \"/validateDonation\",\n            method: \"POST\",\n            data: formData + \"&type=\" + type + \"&payment_gateway=\" + payment_gateway,\n            beforeSend: function( ){\n                \n                //clear any error messages\n                $(\".error\").html( \"\" ).hide( );\n                \n                //change button to show processing\n                $button.html( \"Validating...\");\n                $button.prop(\"disabled\", true);\n            },\n            success: function( resp ){\n                \n            \tif( resp.status ){\n\n            \t\tvar $form = $('form[name=donationCheckoutForm]');\n\n\t                donationObj.first_name \t\t= $form.find(\"input[name=first_name]\").val( );\n\t                donationObj.last_name \t\t= $form.find(\"input[name=last_name]\").val( );\n\t                donationObj.email\t\t\t= $form.find(\"input[name=email]\").val( );\n\t                donationObj.cc_number\t\t= $form.find(\"input[name=cc_number]\").val( );\n\t                donationObj.name_on_card  \t= $form.find(\"input[name=name_on_card]\").val( );\n\t                donationObj.exp_date\t\t= $form.find(\"select[name=exp_date_month]\").find(\"option:selected\").val( ) + \"\" + $form.find(\"select[name=exp_date_year]\").find(\"option:selected\").val( );\n\t                donationObj.ccv \t\t\t= $form.find(\"input[name=ccv]\").val( );\n\t                donationObj.billingAddr1  \t= $form.find(\"input[name=billingAddress1]\").val( );\n\t                donationObj.billingAddr2 \t= $form.find(\"input[name=billingAddress2]\").val( );\n\t                donationObj.billingCity   \t= $form.find(\"input[name=billingCity]\").val( );\n\t                donationObj.billingState \t= $form.find(\"select[name=billingState]\").find(\"option:selected\").text( );\n                    donationObj.billingStateId \t= $form.find(\"select[name=billingState]\").find(\"option:selected\").val( );\n\t                donationObj.billingZip \t\t= $form.find(\"input[name=billingZip]\").val( );\n\t                donationObj.billingCountry  = $form.find(\"select[name=billingCountry]\").find(\"option:selected\").text( );\n                    donationObj.billingCountryId= $form.find(\"select[name=billingCountry]\").find(\"option:selected\").val( );\n\t\t\t\t\tdonationObj.saveAddress\t\t= $form.find(\"input[name=saveAddress]\").is(\":checked\");\n\t\t\t\t\tdonationObj.saveAddressType = type;\n\n\t\t\t\t\t$review \t= $(\".donation-review\");\n\t                $donateForm = $(\".donation-checkout\");\n\t                \n\t                $review.find(\".donation-amount\").html( \"$\" + donationObj.amount );\n\n\t                if( payment_gateway != 3 ){\n\t                \tvar cc_mask = donationObj.cc_number.replace(/\\d{12}(\\d{4})/, \"XXXX XXXX XXXX $1\");\n\t                    \n\t\t                $review.find(\".cc-num\").text( cc_mask );\n\n\t\t                $review.find(\".cc-name\").text( donationObj.name_on_card );\n\n\t\t                $review.find(\".cc-expdate\").text( $form.find(\"select[name=exp_date_month]\").find(\"option:selected\").val( ) + \"/\" + $form.find(\"select[name=exp_date_year]\").find(\"option:selected\").val( ) );\n\n\t\t                $review.find(\".cc-ccv\").text( donationObj.ccv );\n\t                }\n\n\t                $review.find(\".billingaddress1\").text( donationObj.billingAddr1 );\n\n\t                $review.find(\".billingaddress2\").text( donationObj.billingAddr2 );\n\n\t                $review.find(\".billingcity\").text( donationObj.billingCity );\n\n\t                $review.find(\".billingstate\").text( donationObj.billingState );\n\n\t                $review.find(\".billingzip\").text( donationObj.billingZip );\n\n\t                $review.find(\".billingcountry\").text( donationObj.billingCountry );\n\t                \n\t                $button.html( \"review order\");\n\t                $button.prop(\"disabled\", false);\n\n\t                $donateForm.slideUp(\"slow\", function( ){\n\t                \t$review.slideDown(\"slow\");\n\n\t                \t$(\"html, body\").animate({scrollTop: 0},800);\n\t                });\n\t\t\t\t}else{\n\n\t\t\t\t\tfor( var key in resp.errors ){\n                        $(\".\" + key + \"-error\").html( resp.errors[key] ).show( );\n                    }\n\n                    $button.html( \"review order\");\n                    $button.prop(\"disabled\", false);\n\t\t\t\t}\n\t\t\t}\n        });\n    });\n\n    $(\".checkout-button\").on(\"click\", function( ){\n        \n        $donationId = \"\";\n\n        var $button = $(this);\n\n        var donationData = {\n        \tuser_id: \t\t\t\tuserId, \n        \titem_id: \t\t\t\tid, \n        \titem_type: \t\t\t\ttype, \n        \temail: \t\t\t\t\tdonationObj.email, \n        \tbilling_full_name: \t\tdonationObj.first_name + \" \" + donationObj.last_name, \n        \tfirst_name: \t\t\tdonationObj.first_name, \n        \tlast_name: \t\t\t\tdonationObj.last_name, \n        \tcc_number: \t\t\t\tdonationObj.cc_number,\n        \tccv: \t\t\t\t\tdonationObj.ccv,\n        \texp_date: \t\t\t\tdonationObj.exp_date,\n        \tbilling_address_line1: \tdonationObj.billingAddr1, \n        \tbilling_address_line2: \tdonationObj.billingAddr2, \n        \tbilling_city: \t\t\tdonationObj.billingCity, \n        \tbilling_state: \t\t\tdonationObj.billingStateId,  \n        \tbilling_country: \t\tdonationObj.billingCountryId, \n        \tbilling_zip: \t\t\tdonationObj.billingZip, \n        \tdonation_amount: \t\tdonationObj.amount, \n        \tsaveAddress: \t\t\tdonationObj.saveAddress, \n        \ttype: \t\t\t\t\tdonationObj.saveAddressType, \n        \tpayment_gateway: \t\tpayment_gateway \n        }; \n        \n        $.ajax({\n            method: \"post\",\n            url: \"/setPendingDonation\",\n            beforeSend: function( ){\n            \t//change button to show processing\n                \n                $button.html( \"Processing...\");\n                //$button.prop(\"disabled\", true);\n\n            },\n            data: donationData,\n            dataType: \"json\",\n            success: function( data ){\n\n            \t$button.html( \"Checkout\");\n                //$button.prop(\"disabled\", false);\n                \n            \tdataId = data.id;\n                \n                if( payment_gateway == 3 ){\n                 //find the paypalStdForm\n                \n\t                var $checkoutForm = $(\"form[name=paypalStdCheckout]\");\n\t                \n\t                //Input values into the form\n\t                $(\"input[name=cmd]\").val(\"_donations\");\n\t                $(\"input[name=return]\").val(window.location.protocol + \"//\" +  window.location.host + \"/thankyou\");\n\t                $(\"input[name=notify_url]\").val(window.location.protocol + \"//\" +  window.location.host + \"/ipn\");\n\n\t                $(\"input[name=amount]\").val( donationObj.amount );\n\n\t                $(\"input[name=custom]\").val( dataId );\n\t                \n\t                $(\"input[name=business]\").val( paypal_username );\n\t                \n\t                $(\"input[name=first_name]\").val( donationObj.first_name );\n\n\t                $(\"input[name=email]\").val( donationObj.email );\n\t                \n\t                $(\"input[name=last_name]\").val( donationObj.last_name );\n\t                \n\t                $(\"input[name=address1]\").val( donationObj.billingAddr1 );\n\t                \n\t                $(\"input[name=address2]\").val( donationObj.billingAddr2 );\n\t                \n\t                $(\"input[name=city]\").val( donationObj.billingCity );\n\t                \n\t                $(\"input[name=state]\").val( donationObj.billingState );\n\t                \n\t                $(\"input[name=zip]\").val( donationObj.billingZip );\n\t                \n\t                $(\"input[name=country]\").val( donationObj.billingCountry );\n\t                \n\t                $checkoutForm.trigger(\"submit\");\n\t            }else{\n\n\t            \tconsole.dir( data );\n\n\t            \tif( data.status ){\n\n\t            \t\tconsole.log( \"should be true\");\n\t            \t\tconsole.log( data.status );\n\t            \t\n\t\t            \t$(\".thank-you-message\").removeClass('hidden');\n\n\t\t            \t$(\"h1.text-center\").remove( );\n\n\t\t            \t$(\".donation-review-header\").remove( );\n\n\t\t            \t$(\"button.edit-button\").remove( );\n\n\t\t            \t$(\"button.checkout-button\").remove( );\n\n\t\t            \t$(\".donation-review\").find(\".order-review\").prepend(\"<div class='donation-reference'><p class='header'>Reference Number</p>\" + data.txnId + \"</div><hr />\");\n\t\t            }else{\n\t\t            \tconsole.log( \"should be false\");\n\t\t            \tconsole.log( data.status );\n\t\t            \t$(\".donation-review\").find(\".error\").html( data.text ).show( );\t\n\t\t            }\n\t            }\n            }\n        })\n    });\n\n\t//Action for Shipping Address Selection\n    $(\"select[name=userAddresses]\").on(\"change\", function( ){\n        \n        var addressSelected = $(this).find(\":selected\").val( );\n        \n        if( addressSelected == 0 ){\n            $(\"input[name=billingAddress1]\").val( \"\" );\n            $(\"input[name=billingAddress2]\").val( \"\" );\n            $(\"input[name=billingCity]\").val( \"\" );\n            $(\"select[name=billingState] option\").each( function( i ){\n            \tif( i > 0 ){\n            \t\t$(this).remove( );\n            \t}\n            });\n            $(\"input[name=billingZip]\").val( \"\" );\n            $(\"select[name=billingCountry]>option:eq(0)\").prop(\"selected\", true);\n        }else{\n            \n            var addressData = addressSelected.split(\"|\");\n            \n            $(\"input[name=billingAddress1]\").val( addressData[2] );\n            $(\"input[name=billingAddress2]\").val( addressData[3] );\n            $(\"input[name=billingCity]\").val( addressData[4] );\n            $(\"input[name=billingZip]\").val( addressData[6] );\n            \n\t\t\t$(\"select[name=billingCountry]\").find(\"option[value=\" + addressData[7] + \"]\").prop(\"selected\", true);\n\n\t\t\t$(\"select[name=billingCountry]\").trigger(\"change\");\n\n\t\t\tsetTimeout( function( ){\n\t\t\t\t$(\"select[name=billingState]\").find(\"option[value=\" + addressData[5] + \"]\").prop(\"selected\", true);\n\t\t\t}, 1000);\n\t\t}\n    });\n\n    $(\".edit-button\").on(\"click\", function( e ){\n\n    \t$review \t= $(\".donation-review\");\n\t    $donateForm = $(\".donation-checkout\");\n\n\t    $review.slideUp(\"slow\", function( ){\n        \t$donateForm.slideDown(\"slow\");\n        });\n\t});\n\n});"],"sourceRoot":"/source/"}