{"version":3,"sources":["donate-mobile.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"donate-mobile.js","sourcesContent":["\nvar donateObj = {};\n\n$(function( ){\n\t\n\n    $(document).on(\"pagechange\", function( e, data){\n\n        var page = $(this)[0].activeElement.id;\n\n        if( page == \"donate-page-two\" || page == \"donate-page-two\" || page == \"thank-you\" ){\n            if( typeof donateObj.amount !== \"undefined\" ){\n                $(\"input[name=donationAmt]\").val( donateObj.amount );\n            }else{\n                $.mobile.pageContainer.pagecontainer(\"change\", \"#donate-page-one\");\n            }        \n        }\n    });\n\n    var id = \"\";\n\tvar type = \"\";\n\tvar user_id = \"\";\n\tvar paypal_username = \"\";\n    var payment_gateway = \"\";\n\n\tif( $(\"input[name=id]\").length > 0 ){\n\t\tid = $(\"input[name=id]\").val( );\n\t}\n\n\tif( $(\"input[name=pagetype]\").length > 0 ){\n\t\ttype = $(\"input[name=pagetype]\").val( );\n\t}\n\n\tif( $(\"input[name=user_id]\").length > 0 ){\n\t\tuser_id = $(\"input[name=user_id]\").val( );\n\t}\n\n\tif( $(\"input[name=paypalUn]\").length > 0 ){\n\t\tpaypal_username = $(\"input[name=paypalUn]\").val( );\n\t}\n\n    if( $(\"input[name=payment_gateway]\").length > 0 ){\n        payment_gateway = $(\"input[name=payment_gateway]\").val( );\n    }\n\n    $(\"#back-to-site\").on(\"click\", function( ){\n        location.href = \"/\";\n    });\n\n\t$(document).on(\"pagecreate\", \"#donate-login\", function( ){\n\n\t\tvar hash = window.location.hash;\n\n\t\t$(\".button-login\").each( function( ){\n\n\t\t\tvar href = $(this).find(\"a\").attr(\"href\");\n\n\t\t\t$(this).find(\"a\").attr(\"href\", href + \"?mobilepage=donate-login\");\t\t\t\n\n\t\t});\n\t\t\n\t\tif( document.referrer != \"\" ){\n\t\t\tvar urlSplit = document.referrer.split(\"#\");\n\n\t\t\tif( urlSplit.length == 1 ){\n\t\t\t\t$.mobile.pageContainer.pagecontainer(\"change\", \"#donate-page-one\");\n\t\t\t}\n\t\t}\n\t});\n\n\t$(document).on(\"click\", \".continue\", function( e ){\n\n\t\tvar donation = $(\"input[name=donationAmt]\").val( );\n\t\tvar $errorBox = $(\".donationAmountError\");\n\t\tvar error    = 0;\n\n\t\tif( isNaN( parseFloat( donation) ) ){\n\t\t\t\n\t\t\t$errorBox.html( \"Please Enter a Number.\").show( );\n\t\t\terror = 1;\n\n\t\t\tsetTimeout( function( ){ $errorBox.html(\"\").fadeOut( ); }, 3000);\n\n\t\t\te.preventDefault( );\n\t\t\te.stopPropagation( );\n\t\t}\n\n\t\tif( error == 0 ){\n\t\t\tdonateObj.amount = parseFloat(donation).formatMoney(2, ',', '.');\n\n\t\t\t$(\".donationAmount\").html( \"$\" + parseFloat(donation).formatMoney(2, ',', '.') );\t\n\t\t}\n\t});\n\n\t$(\"#continue-to-review\").on(\"click\", function( ){\n\n        var expYear = $('form[name=donationCheckoutForm]').find(\"input[name=exp_date_year]\").val( );\n\n        if( expYear.length == 4 ){\n            expYear = expYear.substring(2,4);\n\n            $('form[name=donationCheckoutForm]').find(\"input[name=exp_date_year]\").val( expYear );\n        }\n        \n        var formData = $('form[name=donationCheckoutForm]').serialize( );\n\n        var $button = $(this);\n        \n        $.ajax({\n            url: \"/validateDonation\",\n            method: \"POST\",\n            data: formData,\n            beforeSend: function( ){\n                \n                //clear any error messages\n                $(\".error\").html( \"\" ).hide( );\n                \n                //change button to show processing\n                $button.html( \"Validating...\");\n                $button.prop(\"disabled\", true);\n            },\n            success: function( resp ){\n\n                if( resp.status ){\n                    $button.html( \"Processing...\");\n                \n                    var $form = $('form[name=donationCheckoutForm]');\n\n                    var expYear = $form.find(\"input[name=exp_date_year]\").val( );\n\n                    if( expYear.length == 4 ){\n                        expYear = expYear.substring(2,4);\n                    }\n\n                    donateObj.first_name        = $form.find(\"input[name=first_name]\").val( );\n                    donateObj.last_name         = $form.find(\"input[name=last_name]\").val( );\n                    donateObj.email             = $form.find(\"input[name=email]\").val( );\n                    donateObj.cc_number         = $form.find(\"input[name=cc_number]\").val( );\n                    donateObj.name_on_card      = $form.find(\"input[name=name_on_card]\").val( );\n                    donateObj.exp_date          = $form.find(\"input[name=exp_date_month]\").val( ) + \"\" + expYear;\n                    donateObj.ccv               = $form.find(\"input[name=ccv]\").val( );\n                    donateObj.billingAddr1      = $form.find(\"input[name=billingAddress1]\").val( );\n                    donateObj.billingAddr2      = $form.find(\"input[name=billingAddress2]\").val( );\n                    donateObj.billingCity       = $form.find(\"input[name=billingCity]\").val( );\n                    donateObj.billingState      = $form.find(\"select[name=billingState]\").find(\"option:selected\").text( );\n                    donateObj.billingStateId    = $form.find(\"select[name=billingState]\").find(\"option:selected\").val( );\n                    donateObj.billingZip        = $form.find(\"input[name=billingZip]\").val( );\n                    donateObj.billingCountry    = $form.find(\"select[name=billingCountry]\").find(\"option:selected\").text( );\n                    donateObj.billingCountryId  = $form.find(\"select[name=billingCountry]\").find(\"option:selected\").val( );\n\n                    var cc_mask = donateObj.cc_number.replace(/\\d{12}(\\d{4})/, \"XXXX XXXX XXXX $1\");\n\n                    $reviewPage = $(\"#donate-page-three\");\n                    $thankYou   = $(\"#thank-you\");\n\n                    var billingAddress = \"<p>Billing Address</p>\" + donateObj.billingAddr1 + \"<br />\";\n                    if( donateObj.billingAddr2 != \"\" ){\n                        billingAddress += donateObj.billingAddr2 + \"<br />\";\n                    }\n\n                    billingAddress += donateObj.billingCity + \", \" + donateObj.billingState + \" \" + donateObj.billingZip + \" <br />\" + donateObj.billingCountry;\n\n                    var creditCardInformation = \"Card Number: \" + cc_mask + \"<br />\";\n                    creditCardInformation += \"Name: \" + donateObj.name_on_card + \"<br />\";\n                    creditCardInformation += \"Exp. Date:\" + $form.find(\"input[name=exp_date_month]\").val( ) + \"/\" + expYear + \"<br />\";\n                    creditCardInformation += \"CVV: \" + donateObj.ccv;\n\n                    $reviewPage.find(\".billingInformationReview\").html( billingAddress );\n                    $thankYou.find(\".billingInformationReview\").html( billingAddress );\n\n                    $reviewPage.find(\".creditCardInformation\").html( creditCardInformation );\n                    $thankYou.find(\".creditCardInformation\").html( creditCardInformation );\n\n                    $reviewPage.find(\".billingTotalReview\").text( \"$\" + donateObj.amount );\n                    $thankYou.find(\".billingTotalReview\").text(\"$\" + donateObj.amount );\n                    \n                    $button.val( \"review order\");\n                    $button.prop(\"disabled\", false);\n                    \n                    $.mobile.pageContainer.pagecontainer(\"change\", \"#donate-page-three\");\n                }else{\n                    for( var key in resp.errors ){\n                        $(\".\" + key + \"-error\").html( resp.errors[key] ).show( );\n                    }\n\n                    $button.html( \"review order\");\n                    $button.prop(\"disabled\", false);\n                }\n            }\n        });\n    });\n\n    $(\"#continue-to-paypal\").on(\"click\", function( ){\n\n    \t$donationId = \"\";\n\n        var $button = $(this);\n        \n        var d = new Date( );\n        \n        var now = d.getYear( ) + \"-\" + d.getMonth( ) + \"-\" + d.getDate( ) + \" \" + d.getHours( ) + \":\" + d.getMinutes( ) + \":\" + d.getMilliseconds( );\n\n        var donationData = {\n            user_id:                user_id, \n            item_id:                id, \n            item_type:              type, \n            billing_full_name:      donateObj.first_name + \" \" + donateObj.last_name, \n            first_name:             donateObj.first_name, \n            last_name:              donateObj.last_name, \n            email:                  donateObj.email,\n            billing_address_line1:  donateObj.billingAddr1, \n            billing_address_line2:  donateObj.billingAddr2, \n            billing_city:           donateObj.billingCity, \n            billing_state:          donateObj.billingStateId,  \n            billing_country:        donateObj.billingCountryId, \n            billing_zip:            donateObj.billingZip, \n            donation_amount:        donateObj.amount,\n            cc_number:              donateObj.cc_number,\n            ccv:                    donateObj.ccv,\n            exp_date:               donateObj.exp_date,\n            payment_gateway:        payment_gateway \n        };\n        \n        $.ajax({\n            method: \"post\",\n            url: \"/setPendingDonation\",\n            data: donationData,\n            beforeSend: function( ){\n\n                $button.html( \"Processing...\");\n                $button.prop(\"disabled\", true);\n            },\n            dataType: \"json\",\n            success: function( data ){\n                \n                dataId = data.id;\n\n                $button.html( \"Checkout\");\n                $button.prop(\"disabled\", false);\n                \n                if( payment_gateway == 3 ){\n\n                     //find the paypalStdForm\n                    var $checkoutForm = $(\"form[name=paypalStdCheckout]\");\n                    \n                    //Input values into the form\n                    $checkoutForm.find(\"input[name=cmd]\").val(\"_donations\");\n                    $checkoutForm.find(\"input[name=return]\").val(window.location.protocol + \"//\" +  window.location.host + \"/thankyou\");\n                    $checkoutForm.find(\"input[name=notify_url]\").val(window.location.protocol + \"//\" +  window.location.host + \"/ipn\");\n\n                    $checkoutForm.find(\"input[name=amount]\").val( donateObj.amount );\n\n                    $checkoutForm.find(\"input[name=custom]\").val( dataId );\n                    \n                    $checkoutForm.find(\"input[name=business]\").val( paypal_username );\n                    \n                    $checkoutForm.find(\"input[name=first_name]\").val( donateObj.first_name );\n                    \n                    $checkoutForm.find(\"input[name=last_name]\").val( donateObj.last_name );\n\n                    $checkoutForm.find(\"input[name=email]\").val( donateObj.email );\n                    \n                    $checkoutForm.find(\"input[name=address1]\").val( donateObj.billingAddr1 );\n                    \n                    $checkoutForm.find(\"input[name=address2]\").val( donateObj.billingAddr2 );\n                    \n                    $checkoutForm.find(\"input[name=city]\").val( donateObj.billingCity );\n                    \n                    $checkoutForm.find(\"input[name=state]\").val( donateObj.billingState );\n                    \n                    $checkoutForm.find(\"input[name=zip]\").val( donateObj.billingZip );\n                    \n                    $checkoutForm.find(\"input[name=country]\").val( donateObj.billingCountry );\n                    \n                    $checkoutForm.trigger(\"submit\");\n                }else{\n\n                    $(\"#thank-you\").find(\".transaction-id\").html( data.txnId );\n\n                     $.mobile.pageContainer.pagecontainer(\"change\", \"#thank-you\");   \n                }\n            }\n        })\n    });\n\n    //Action for Shipping Address Selection\n    $(\"select[name=userAddresses]\").on(\"change\", function( ){\n        \n        var addressSelected = $(this).find(\":selected\").val( );\n        \n        if( addressSelected == 0 ){\n            $(\"input[name=billingAddress1]\").val( \"\" );\n            $(\"input[name=billingAddress2]\").val( \"\" );\n            $(\"input[name=billingCity]\").val( \"\" );\n            $(\"select[name=billingState] option\").each( function( i ){\n                if( i > 0 ){\n                    $(this).remove( );\n                }\n            });\n            $(\"input[name=billingZip]\").val( \"\" );\n            $(\"select[name=billingCountry]>option:eq(0)\").prop(\"selected\", true);\n        }else{\n            \n            var addressData = addressSelected.split(\"|\");\n            \n            $(\"input[name=billingAddress1]\").val( addressData[2] );\n            $(\"input[name=billingAddress2]\").val( addressData[3] );\n            $(\"input[name=billingCity]\").val( addressData[4] );\n            $(\"input[name=billingZip]\").val( addressData[6] );\n            \n            $(\"select[name=billingCountry]\").find(\"option[value=\" + addressData[7] + \"]\").prop(\"selected\", true);\n\n            $(\"select[name=billingCountry]\").trigger(\"change\");\n\n            setTimeout( function( ){\n                $(\"select[name=billingState]\").find(\"option[value=\" + addressData[5] + \"]\").prop(\"selected\", true);\n            }, 1000);\n        }\n    });\n});"],"sourceRoot":"/source/"}