{"version":3,"sources":["purchase-mobile.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"purchase-mobile.js","sourcesContent":["$(function( ){\n\n\t/**\n\t*\n\t* Checkout process for products\n\t*\n\t*/\n\n\tsetTimeout(function () {\n        page = $(':mobile-pagecontainer').pagecontainer('getActivePage')[0].id;\n\n        if( page == \"purchase-page-one\" || page == \"purchase-page-two\" || page == \"thank-you\" ){\n            if( typeof data.price === \"undefined\" ){\n                location.href = \"/product/\" + $(\"input[name=alias]\").val( );\n            }        \n        }\n    }, 1000);\n\t\n\tvar paypal_username = $(\"input[name=paypalUn]\").val( );\n    var user_id         = $(\"form[name=purchaseCheckoutForm]\").find(\"input[name=user_id]\").val( );\n\n    //Get Project Data\n    \n    var product_name \t= $(\"input[name=product_name]\").val( );\n    var org_name \t\t= $(\"input[name=org_name]\").val( );\n    var product_id \t\t= $(\".add-to-cart\").data('id');\n    var payment_gateway = 2;\n    \n    var data \t\t\t= {user_id: user_id, id: product_id, shipping: parseFloat( $(\"input[name=shipping]\").val( ) ), saveShipping: false, saveBilling: false, payment_gateway: payment_gateway};\n\n    $(document).on(\"click\", \"#back-to-site\", function( e ){\n\n        var alias = $(this).data('alias');\n\n        location.href = '/';\n\n    });\n    \n    /**\n\t*\n\t* Initial step to open up the lightbox to continue with the product checkout\n\t*\n\t*/\n    \n    $(\".add-to-cart\").on(\"click\", function( ){\n\t    \n        //$(this).prop('disabled', 'true');\n        \n\t\tvar modifiers = [];\n        var errors    = [];\n        var product_alias = $(this).data('alias');\n        \n        $(\".error\").hide( );\n\n\t\t$(\".product-modifiers select\").each(function( i ){\n\t        \n\t        var name \t\t= $(this).find(\"option:first\").text( );\n\t\t\t\n\t\t\tvar value \t\t= $(this).find(\":selected\").val( );\n\t\t\tvar valueText \t= $(this).find(\":selected\").text( );\n\n\t\t\tvar modId \t\t= $(this).data('mod-id');\n\n\t\t\tif( value == 0 ){\n\t\t\t\terrors.push($(this).attr(\"name\") + \"|\" + \"Please select a \" + name);\n\t\t\t}else{\n\t\t\t\tmodifiers.push(\"<div class='modifier'><b>\" + name.replace(\"Select \", \"\") + \"</b>: \" + valueText + \"</div>\");\n\t\t\t\t$(\"#purchase-page-one, #purchase-page-two, #thank-you\")\n\t\t\t\t.find(\".name[data-id=\" + modId + \"]\")\n\t\t\t\t.html( name.replace(\"Select\",\"\") );\n\n\t\t\t\t$(\"#purchase-page-one, #purchase-page-two, #thank-you\")\n\t\t\t\t.find(\".value[data-id=\" + modId + \"]\")\n\t\t\t\t.html( valueText );\n\t\t\t}\n\t\t});\n\t\t\n\t\tif( $(\"select[name=quantity]\").find(\":selected\").val( ) == \"0\" ){\n\t\t\terrors.push(\"quantity|Please Input a Quantity\");\n\t\t}\n\t\t\n\t\tif( errors.length == 0 ){\n\t\t\t\n\t\t\tdata.price \t = parseFloat( $(\".price\").data('price') ).formatMoney(2, ',', '.');\n\t\t\t\n\t\t\tdata.quantity = parseInt( $(\"select[name=quantity]\").find(\":selected\").val( ) );\n\n\t\t\t$(\"#purchase-page-one, #purchase-page-two, #thank-you\")\n\t\t\t.find(\".quantity\")\n\t\t\t.html( data.quantity );\n\n\t\t\t$(\"#purchase-page-one, #purchase-page-two, #thank-you\")\n\t\t\t.find(\".price\")\n\t\t\t.html( \"$\" + data.price );\n\n\t\t\t$.mobile.pageContainer.pagecontainer(\"change\", \"#purchase-page-one\");\n\t\t\t\n\t\t}else{\n\t\t\t\n\t\t\tfor(var x in errors){\n\t\t\t\t\n\t\t\t\tvar error = errors[x].split(\"|\");\n\t\t\t\t\n\t\t\t\t$(\".\" + error[0] + \"-error\").html(error[1]).show( );\n\t\t\t}\n\t\t}\n    });\n    \n    /*\n\t*\n\t* Create event for getting quantity amount for selected modifiers\n\t*\n\t*/\n\t\n\tvar modifierOptions = [];\n\tvar combo = \"\";\n\t\n\t$(\".product-modifiers select\").on(\"change\", function( i ){\n\t\t\n\t\tvar allSelected = true;\n\t\t\n\t\t$(\".product-modifiers select\").each( function( i ){\n\t\t\t\n\t\t\tif( parseInt( $(this).find(\":selected\").val( ) ) == 0 ){\n\t\t\t\tallSelected = false;\n\t\t\t}\n\t\t});\n\t\t\n\t\tif( allSelected ){\n\t\t\t\n\t\t\t$(\".product-modifiers select\").each( function( i ){\n\t\t\t\tmodifierOptions.push( parseInt( $(this).find(\":selected\").val( ) ) );\t\n\t\t\t});\n\t\t\t\n\t\t\tmodifierOptions = modifierOptions.reverse( );\n\t\t\t\t\n\t\t\tcombo = modifierOptions.join( );\n\t\t\t\n\t\t\tdata.modifierId = combo;\n\t\t\t\n\t\t\t$.ajax({\n\t\t\t\tmethod: \"get\",\n\t\t\t\turl: \"/products/getQuantity\",\n\t\t\t\tdata: \"options=\" + combo + \"&id=\" + product_id,\n\t\t\t\tdataType: \"json\",\n\t\t\t\tbeforeSend: function( ){\n\n\t\t\t\t\t$(\"select[name=quantity] option\").each( function( i ){\n\t\t\t\t\t\tif( i > 0 ){\n\t\t\t\t\t\t\t$(this).remove( );\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(\"select[name=quantity]\").find(\"option:first\").html(\"Getting Quantity ...\");\n\t\t\t\t},\n\t\t\t\tsuccess: function( resp ){\n\t\t\t\t\t$(\"select[name=quantity]\").find(\"option:first\").html(\"Select Quantity\");\n\t\t\t\t\tmodifierOptions = [];\n\t\t\t\t\t\n\t\t\t\t\tif( parseInt( resp.count ) > 0 ){\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor( var i = 1 ; i <= resp.count ; i++ ){\n\t\t\t\t\t\t\t$(\"select[name=quantity]\").append(\"<option value='\" + i + \"'>\" + i + \"</option>\");\n\t\t\t\t\t\t\t//$details.find(\"select[name=product-quantity]\").append(\"<option value='\" + i + \"'>\" + i + \"</option>\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t//data.modifierId = resp.modifier_id;\n\t\t\t\t\t\t\n\t\t\t\t\t\t$(\".price\").data(\"price\", resp.price);\n\t\t\t\t\t\t$(\".price\").html(\"$\" + parseFloat( resp.price ) + \".00\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}else{\n\t\t\t\n\t\t\tif( $(\"select[name=quantity]\").length > 1 ){\n\t\t\t\t\n\t\t\t\t$(\"select[name=quantity] option\").each( function( i ){\n\t\t\t\t\t\n\t\t\t\t\tif( i > 0 ){\n\t\t\t\t\t\tremove( $(this) );\n\t\t\t\t\t}\n\t\t\t\t});\t\n\t\t\t}\n\t\t}\n\t});\n    \n    /**\n\t*\n\t* Step 1 Continue checkout     \n\t*    \n\t*/\n    \n    $(\"#purchase-page-one\").find('.continue-button').on(\"click\", function( ){\n\n    \tvar expYear = $('form[name=purchaseCheckoutForm]').find(\"input[name=exp_date_year]\").val( );\n\n        if( expYear.length == 4 ){\n            expYear = expYear.substring(2,4);\n\n            $('form[name=purchaseCheckoutForm]').find(\"input[name=exp_date_year]\").val( expYear );\n        }\n\t    \n\t    var formData = $('form[name=purchaseCheckoutForm]').serialize( );\n\n\t    console.log( formData );\n\n\t    var $button = $(this);\n\t\t\n\t\t$.ajax({\n            url: \"/product/validateCheckout\",\n            method: \"POST\",\n            data: formData,\n            beforeSend: function( ){\n                \n                //clear any error messages\n                $(\".error\").html( \"\" ).addClass('hidden');\n                \n                //change button to show processing\n\t\t\t\t$button.html( \"Validating...\");\n\t\t        $button.prop(\"disabled\", true);\n            },\n            success: function( resp ){\n\t            \n\t            $button.html( \"review order\");\n\t\t        $button.prop(\"disabled\", false);\n\t\t        \n\t\t        if( resp.status ){\n\n\t\t        \tvar $form = $('form[name=purchaseCheckoutForm]');\n\n\t\t        \tvar expYear = $form.find(\"input[name=exp_date_year]\").val( );\n\n\t                if( expYear.length == 4 ){\n\t                    expYear = expYear.substring(2,4);\n\t                }\n\t\t\t        \n\t\t\t        data.first_name\t\t\t\t= $form.find(\"input[name='first_name']\").val( );\n\t\t\t        data.last_name\t\t\t\t= $form.find(\"input[name='last_name']\").val( );\n\t\t\t        data.email\t\t\t\t\t= $form.find(\"input[name='email']\").val( );\n\t\t\t        data.shipping_address_line1 = $form.find(\"input[name='shippingAddress1']\").val( );\n\t\t\t        data.shipping_address_line2 = $form.find(\"input[name='shippingAddress2']\").val( );\n\t\t\t        data.shipping_city  \t\t= $form.find(\"input[name='shippingCity']\").val( );\n\t\t\t        data.shipping_state\t\t\t= $form.find(\"select[name='shippingState']\").find(\"option:selected\").text( );\n\t\t\t        data.shippingstateId\t\t= $form.find(\"select[name='shippingState']\").find(\"option:selected\").val( );\n\t\t\t        data.shipping_zip\t\t\t= $form.find(\"input[name='shippingZip']\").val( );\n\t\t\t        data.shipping_country\t\t= $form.find(\"select[name='shippingCountry']\").find(\"option:selected\").text( );\n\t\t\t        data.shippingcountryId\t\t= $form.find(\"select[name='shippingCountry']\").find(\"option:selected\").val( );\n\t\t\t        data.billing_address_line1\t= $form.find(\"input[name='billingAddress1']\").val( );\n\t\t\t        data.billing_address_line2  = $form.find(\"input[name='billingAddress2']\").val( );\n\t\t\t        data.billing_city\t\t\t= $form.find(\"input[name='billingCity']\").val( );\n\t\t\t        data.billing_state \t\t\t= $form.find(\"select[name=billingState]\").find(\"option:selected\").text( );\n\t\t\t        data.billingstateId\t\t\t= $form.find(\"select[name=billingState]\").find(\"option:selected\").val( );\n\t\t\t        data.billing_zip\t\t\t= $form.find(\"input[name='billingZip']\").val( );\n\t\t\t        data.billing_country\t\t= $form.find(\"select[name=billingCountry]\").find(\"option:selected\").text( );\n\t\t\t        data.billingcountryId\t\t= $form.find(\"select[name=billingCountry]\").find(\"option:selected\").val( );\n\t\t\t        data.cc_number\t\t\t\t= $form.find(\"input[name=cc_number]\").val( );\n                \tdata.name_on_card  \t\t\t= $form.find(\"input[name=name_on_card]\").val( );\n                \tdata.exp_date\t\t\t\t= $form.find(\"input[name=exp_date_month]\").val( ) + \"\" + expYear;\n                \tdata.ccv \t\t\t\t\t= $form.find(\"input[name=ccv]\").val( );\n\n                \tvar cc_mask = data.cc_number.replace(/\\d{12}(\\d{4})/, \"XXXX XXXX XXXX $1\");\n\t\t\t\t        \n\t\t\t        var shipping;\n\n\t\t\t\t\tvar $review \t= $(\"#purchase-page-two\");\n\t\t\t\t\tvar $thankYou \t= $(\"#thank-you\");\n\n\t\t\t\t\tdata.shipping = parseFloat( data.shipping ).formatMoney(2, ',', '.');\n\t\t\t\t\t\n\t\t\t\t\tif( parseInt( data.shipping) == 0 ){\n\t\t\t\t\t\tshipping = 0.00;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tshipping = parseFloat( data.shipping );\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar subTotal = parseFloat( data.price ) * parseInt( data.quantity );\n\t\t\t\t\t\n\t\t\t\t\tvar tax = (subTotal/100) * parseFloat( resp.taxCode.tax_percentage );\n\t\t\t\t\t\n\t\t\t\t\tdata.tax = parseFloat(tax).formatMoney(2, ',', '.');\n\t\t\t\t\t\n\t\t\t\t\tvar total = parseFloat(subTotal) + parseFloat( tax ) + parseFloat( data.shipping);\n\n\t\t\t\t\ttotal = total.formatMoney(2, ',', '.');\n\n\t\t\t\t\tvar shippingAddress = data.shipping_address_line1 + \"<br />\";\n\n\t\t\t\t\tif( data.shipping_address_line2 != \"\" ){\n\t\t\t\t\t\tshippingAddress += data.shipping_address_line2 + \"<br />\";\n\t\t\t\t\t}\n\n\t\t\t\t\tshippingAddress += data.shipping_city + \", \" + data.shipping_state + \" \" + data.shipping_zip;\n\t\t\t\t\tshippingAddress += \"<br />\" + data.shipping_country;\n\t\t\t\t\t\n\t\t\t\t\t$review.find(\".shipping-address\").html( shippingAddress );\n\t\t\t\t\t$thankYou.find(\".shippingInformationReview\").html( shippingAddress );\n\n\t\t\t\t\tvar billingAddress = data.billing_address_line1 + \"<br />\";\n\n\t\t\t\t\tif( data.billing_address_line2 != \"\" ){\n\t\t\t\t\t\tbillingAddress += data.billing_address_line2 + \"<br />\";\n\t\t\t\t\t}\n\n\t\t\t\t\tbillingAddress += data.billing_city + \", \" + data.billing_state + \" \" + data.billing_zip;\n\t\t\t\t\tbillingAddress += \"<br />\" + data.billing_country;\n\t\n\t                $review.find(\".billing-address\").html( billingAddress );\n\t                $thankYou.find(\".billingInformationReview\").html( billingAddress );\n\n\t                var creditCardInformation = \"Card Number: \" + cc_mask + \"<br />\";\n                    creditCardInformation += \"Name: \" + data.name_on_card + \"<br />\";\n                    creditCardInformation += \"Exp. Date:\" + $form.find(\"input[name=exp_date_month]\").val( ) + \"/\" + expYear + \"<br />\";\n                    creditCardInformation += \"CVV: \" + data.ccv;\n\n\t\t\t\t\t$review.find(\".credit-card-information\").html( creditCardInformation );\n                \t$thankYou.find(\".creditCardInformation\").html( creditCardInformation );\n\t                \n\t                $review.find(\".item-price\").text( \"$\" + parseFloat(data.price * data.quantity).formatMoney(2, ',', '.') );\n\t                $thankYou.find(\".item-price\").text( \"$\" + parseFloat(data.price * data.quantity).formatMoney(2, ',', '.') );\n\t                \n\t                $review.find(\".item-tax\").text( \"$\" + parseFloat( tax ).formatMoney(2, ',', '.') );\n\t                $thankYou.find(\".item-tax\").text( \"$\" + parseFloat( tax ).formatMoney(2, ',', '.') );\n\t                \n\t                $review.find(\".item-shipping\").text( \"$\" + parseFloat(shipping).formatMoney(2, ',', '.') )\n\t                $thankYou.find(\".item-shipping\").text( \"$\" + parseFloat(shipping).formatMoney(2, ',', '.') )\n\t                \n\t                $review.find(\".item-total\").text(\"$\" + parseFloat( total ).formatMoney(2, ',', '.') );\n\t                $thankYou.find(\".item-total\").text(\"$\" + parseFloat( total ).formatMoney(2, ',', '.') );\n\t                \n\t                $review.find(\".product-amount span\").html( \"$\" + parseFloat( data.price ).formatMoney(2, ',', '.') );\n\t                $thankYou.find(\".product-amount span\").html( \"$\" + parseFloat( data.price ).formatMoney(2, ',', '.') );\n\t                \n\t                $review.find(\".quantity\").html( data.quantity );\n\t                $thankYou.find(\".quantity\").html( data.quantity );\n\t                \n\t                $review.find(\".total span\").html( parseFloat( subTotal ).formatMoney(2, ',', '.') );\n\t                $thankYou.find(\".total span\").html( parseFloat( subTotal ).formatMoney(2, ',', '.') );\n\n\t                $review.find(\".product-total-amount\").html( \"$\" + total );\n\t                $thankYou.find(\".product-total-amount\").html( \"$\" + total );\n\n\t                $.mobile.pageContainer.pagecontainer(\"change\", \"#purchase-page-two\");\n\t                \n\t            }else{\n\t\t\t        \n\t\t\t        var errors = resp.errors;\n                    \n                    for( var key in errors ){\n                        $(\".\" + key + \"-error\").html( errors[key] ).removeClass( 'hidden' ).show( );\n                    }\n\n                    $button.html( \"review order\");\n\t\t        \t$button.prop(\"disabled\", false);\n\t\t\t\t}\n            }\n        });\n\t});\n    \n    /*\n    *\n    * Actions for step 3 ( Order Review )\n    *\n    */\n    \n    $(\"#purchase-page-two\").find(\".checkout-button\").on(\"click\", function( ){\n    \n    \tvar order_id = 0;\n\n    \tdata.saveBilling \t= false;\n    \tdata.saveShipping \t= false;\n\n    \tvar $button = $(this);\n\n    \tif( $('form[name=purchaseCheckoutForm]').find(\"input[name=saveShippingAddress]\").is(\":checked\") ){\n    \t\tdata.saveShipping = true;\n    \t}\n\n    \tif( $('form[name=purchaseCheckoutForm]').find(\"input[name=saveBillingAddress]\").is(\":checked\") ){\n    \t\tdata.saveBilling = true;\n    \t}\n\n    \t$.ajax({\n\t    \tmethod: \"post\",\n\t    \turl: \"/products/setPendingTransaction\",\n\t    \tdata: data,\n\t    \tdataType: \"json\",\n\t    \tsuccess: function( resp ){\n\t\t    \t\n\t\t    \t//order_id = resp.order_id;\n\t\t    \t\n\t\t    \t$(\"#thank-you\").find(\".transaction-id\").html( resp.txnId );\n\n                $.mobile.pageContainer.pagecontainer(\"change\", \"#thank-you\"); \n\t\t    }\n    \t});\n    });\n});"],"sourceRoot":"/source/"}